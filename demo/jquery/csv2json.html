<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CSV to JSON demo</title>
  <link rel='stylesheet' href='/bower_components/bootstrap/dist/css/bootstrap.min.css'/>
  <link rel='stylesheet' href='/bower_components/font-awesome/css/font-awesome.css'/>

  <script src='/bower_components/jquery/dist/jquery.min.js'></script>
  <script src='/bower_components/bootstrap/dist/js/bootstrap.min.js'></script>
  <script src="https://d3js.org/d3.v3.min.js"></script>

</head>
<body>

<div class="container">

  <div class="page-header"><h1>CSV to JSON Demo</h1></div>

  <div>
    <div class="input-group input-group-lg"
         role="group" aria-label="...">
      <span class="input-group-addon">
        <i class="fa fa-search text-primary"></i>
        Path to CSV file:
      </span>
      <div class="form-group form-group-lg has-feedback has-clear">
        <input type="text" class="form-control"
               value="intranet-size.txt"
               placeholder="Find Acronyms"
               id="source-file"
               aria-describedby="sizing-addon"/>
        <span class="form-control-clear text-primary
                     glyphicon glyphicon-remove
                     form-control-feedback hidden"></span>
      </div>
    </div>
  </div>
  
  <div class="row" id="search-bar">
    <div class="col-md-5">
    Source CSV:<br/>
    <textarea style="width:100%" id="csvstring" rows="30"></textarea>
    </div>

    <div class="col-md-2">
      <button id="load">Load</button><br/>
      <button id="convert">2 JSON</button>
    </div>

    <div class="col-md-5">
    JSON:<br/>
    <textarea style="width:100%" id="jsonstring" rows="30"></textarea>
    </div>
  </div>
</div>
 
<script>

jQuery(document).ready(function($) {

    $('#load').on('click', function() {

        //alert('loading');
        var source = $('#source-file').val();
        $.ajax({
            type: "GET",
            url: source,
            dataType: "text",
            success: function(data) {
                $('#csvstring').val(data);
            }
        });
    });

    $('#convert').on('click', function() {

        // read the csv.
        var origin = $('#csvstring').val();
        var originLines = origin.split(/\r\n|\n/);
        // array for each circle:
        var circles = [];
        var color = d3.scale.linear().domain([0, originLines.length])
            .range(["blue", "yellow"])
            .interpolate(d3.interpolateHcl);
        //alert(originLines.length);
        for(var i = 0; i < originLines.length; i++) {
            var row = originLines[i].split(',');
            var circle = {
              "name": row[1],
              "children":[{
                "name": row[1],
                "size": parseInt(row[0].trim()),
                "leafFill": color(i),
                "imgUrl": ''
              }]
            };

            circles.push(circle);
        }

        var jsonData = {
          "attributes": {
            "title": "3 Equal size circles",
            "description": "Data example to show the data structure",
            "colorRange": [
              "white"
            ],
            "leafFill": "green"
          },
          "data": {
            "name":"This will NOT show anywhere!",
            "children": circles
          }
        };

        $('#jsonstring').html(JSON.stringify(jsonData, null, 2));
    });
});

</script>
 
</body>
</html>
