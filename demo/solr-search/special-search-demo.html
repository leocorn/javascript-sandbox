<html no-ng-app="ssDemo">
  <head>
    <title>Demo Special Search Page</title>

    <link rel='stylesheet' href='/bower_components/bootstrap/dist/css/bootstrap.min.css'/>
    <link rel='stylesheet' href='/bower_components/font-awesome/css/font-awesome.css'/>

    <link rel='stylesheet' href='/bower_components/jquery-ui/themes/base/jquery-ui.css'/>
    <link rel='stylesheet' href='/bower_components/jquery-ui-bootstrap/jquery.ui.theme.css'/>

    <script src='/bower_components/jquery/dist/jquery.min.js'></script>
    <script src='/bower_components/jquery-ui/jquery-ui.min.js'></script>
    <script src='/bower_components/bootstrap/dist/js/bootstrap.min.js'></script>
    <script src='/bower_components/angular/angular.min.js'></script>

    <script src='/src/search/searchStrap.js'></script>
    <script>
// this will replace the code in controller.js
//var simpleTest = angular.module('ssDemo', []);

jQuery(document).ready(function($) {

    $('#search-input').searchStrap({
        searchUrl: 'http://gsddtovsdvap014.cihs.gov.on.ca/wp-admin/admin-ajax.php?callback=?&action=opspedia_advanced_search',
        //searchUrl: '/advancedsearch',
        itemsPerPage: 30,
        // we don't need search button here.
        //searchButton: 'sizing-addon',
        facet: {
            facetField: ['authors']
        },
        resultSelector: '#result-list'
    });

    //specialSearch();

    //$('#search-input').keyup(function(event) {
    //    var term = $(this).val();
    //    if(term.length > 1 || term.length == 0) {
    //        specialSearch(term);
    //    }
    //});
});

function specialSearch(searchTerm) {

    var searchTerm = typeof searchTerm == 'undefined' ? '' : searchTerm

    var thefacet = {
         facetField: ['site', 'keywords', 'authors']
    }; 

    $.ajax({
      url: 'http://gsddtovsdvap014.cihs.gov.on.ca/wp-admin/admin-ajax.php?callback=?&action=opspedia_advanced_search',
      method: 'GET',
      dataType: 'json',
      data: {
          term: searchTerm,
          start: 1,
          perPage: 30,
          facet: JSON.stringify(thefacet),
          fq: 'site: wiki AND keywords: Acronyms' 
          //fq: 'keywords: "User Profile"' 
      },
      success: function(data) {
          var total = data.length;
          console.log(data);
          var docs = data.docs;
          var results = $('#result-list');
          results.html('');
          var colQueue = [];
          for(i = 0; i < docs.length; i++) {
              var acronym = docs[i];
              var panel = buildAcronymPanel(acronym);
              colQueue.push(panel);
              // i count from 0
              // 6 acronyms for a row
              var ready2Row = (i + 1) % 6;
              if(ready2Row == 0) {
                  results.append('<div class="row">' +
                      colQueue.join("") + '</div>');
                  // reset the queue.
                  colQueue = [];
              }
          }

          // check if we missed anything...
          if(colQueue.length > 0) {

              // append to the last row.
              results.append('<div class="row">' +
                  colQueue.join(" ") +
                  '</div>');
          }
      }
    });
}

// utility function to build the panel for a project.
function buildAcronymPanel(project) {

    var panel = '<div class="col-sm-2">' + 
        '<h2><a href="' + project['url'] + '">' +
        project['title'] + '</a></h2>' +
        '<p>' + project['description'] + '</p>' + 
        '</div>';
    return panel;
}

    </script>
  </head>

  <body>
    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container">
        <h1>
          <img src="https://www.ontario.ca/img/favicon.png" alt="..." class="img-rounded">
          OPS Acronyms
        </h1>
        <p>The following is a partial list of acronyms used throughout the <a href="http://intra.net.gov.on.ca/wiki/Ontario_Public_Service">Ontario Public Service</a>. This list is incomplete, and you can help!
        </p>

      </div>
    </div>

    <div class="container">
      <!-- Search bar -->
      <div class="container container-fluid bg-muted">
      <div class="row" id="search-bar">
        <div class="col-md-2">
        </div>

        <div class="col-md-8">
          <div class="input-group input-group-lg"
               role="group" aria-label="...">
            <span class="input-group-addon">
              <i class="fa fa-search text-primary"></i>
            </span>
            <input type="text" class="form-control"
                   placeholder="Find Acronyms"
                   id="search-input"
                   aria-describedby="sizing-addon"/>
          </div>
        </div>

        <div class="col-md-2">
        </div>
      </div>
      </div>

      <!-- Example row of columns -->
      <div class="container container-fluid" id="result-list">
      <div class="row">
        <div class="col-md-4">
          <h2>Heading</h2>
          <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
          <p><a class="btn btn-default" href="#" role="button">View details &raquo;</a></p>
        </div>
        <div class="col-md-4">
          <h2>Heading</h2>
          <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
          <p><a class="btn btn-default" href="#" role="button">View details &raquo;</a></p>
       </div>
        <div class="col-md-4">
          <h2>Heading</h2>
          <p>Donec sed odio dui. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Vestibulum id ligula porta felis euismod semper. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
          <p><a class="btn btn-default" href="#" role="button">View details &raquo;</a></p>
        </div>
      </div>
      </div>

      <div class="container container-fluid">
      <hr>
      <footer>
        <p>&copy; 2016 Company, Inc.</p>
      </footer>
      </div>
    </div> <!-- /container -->
  </body>
</html>
